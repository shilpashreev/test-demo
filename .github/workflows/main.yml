name: Playwright Tests & Reports

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
      
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
      
      - name: Install dependencies
        run: npm ci

      - name: Install Playwright browsers
        run: npx playwright install --with-deps
      
      # --- CRITICAL STEP: Generating Reports ---
      - name: Run Playwright tests and generate reports
        # We use '|| true' to ensure the workflow continues and deploys reports 
        # even if some tests fail.
        # Playwright automatically uses the 'reporter' settings from your config file.
        run: npx playwright test || true
        
      # --- Verification Step (Optional but Recommended) ---
      # This step confirms the report files actually exist after the tests run.
      - name: Check for generated reports
        run: |
          echo "Checking for HTML report folder..."
          ls -R playwright-report/
          echo "Checking for JUnit XML file..."
          ls results/junit.xml
          
      # --- Upload Report Artifact ---
      - name: Setup Pages
        uses: actions/configure-pages@v5

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        if: always() # Run even if tests failed
        with:
          # This must match the directory where the HTML reporter puts files
          path: 'playwright-report'
